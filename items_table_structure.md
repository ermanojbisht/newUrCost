**SOR (Schedule of Rates) items table structure** in MySQL, focusing on hierarchy, relationships, and meaning of some fields.

---

### üìò SOR Item Table Structure (Nested Hierarchy)

The **SOR (Schedule of Rates)** system is designed to manage a hierarchical structure of items and chapters, where each SOR contains multiple chapters, and each chapter may contain sub-chapters or items.

All this hierarchical data is stored in a single table ‚Äî the **`items`** table ‚Äî which represents both **chapters** and **items** in a nested structure.
items table has more then one SOR . so for set of a sor nodes (chapter,sub-chapter,item) has a common field value of sor_id. root not of a particular SOR has parent_id as null

---

### üß© Table Overview

Each record (row) in the `items` table represents a node in this hierarchy ‚Äî it can be:

* A **root SOR** (top-level chapter)
* A **chapter** (which may have sub-chapters or items)
* An **item** (which has a rate and listed under one or more chapters , subchapters)

---

### ‚öôÔ∏è Table Fields and Their Purpose

| Field Name                    | Description                                                                                                                                                                     |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **id**                        | Primary key. Unique identifier for each node (chapter/item).                                                                                                                    |
| **parent_id**                 | References the parent node. If `NULL`, this node is a **root SOR**.                                                                                                             |
| **sor_id**                    | Indicates which SOR the node belongs to (useful as multiple SORs share the same table).                                                                                       |
| **item_type**                 | Defines the type of the record: <br>‚Ä¢ `1` ‚Üí Root chapter (top level) <br>‚Ä¢ `2` ‚Üí Sub-chapter (nested under another chapter) <br>‚Ä¢ `3` ‚Üí Actual item (contains rate information) |
| **item_code**                 | Unique item identifier (string stored as text, though numeric). Chapters have `0` as item code.                                                                                 |
| **description**               | almost one line or a para description of the chapter or item.                                                                                                                                       |
| **name**                      | **Computed Name:** For `item_type = 3` (Actual item), the name is a hierarchical composition of its ancestors' descriptions (excluding the SOR root node, and only including ancestors with `item_type` 1 or 2), followed by the item's own `description`, separated by newlines. For `item_type` 1 or 2 (Root chapter or Sub-chapter), the name is simply its own `description`. This field is automatically generated by the `ItemObserver`. |
| **order_in_parent**           | Defines the display or sequence order of this node among its siblings (used to sort chapters/items under a parent).                                                             |
| **nested_item_level**         | **(Deprecated/Redundant)** This field is redundant as the `lft` field from the Nested Set Model provides the same ordering information. It is recommended to use `lft` for tree traversal and ordering. |
| **lft** / **rgt** / **depth** | Standard **Nested Set Model** fields for efficient hierarchical queries and ordering.                                                                                           |

---

### üå≤ Example Hierarchy

| ID | Parent ID | Item Type | Description | Order in Parent | Hierarchy                            |
| -- | --------- | --------- | ----------- | --------------- | -------------------------------------|
| 1  | NULL      | NULL      | Root SOR    | ‚Äî               | Root                                 |
| 2  | 1         | 1         | Chapter 1   | 1               | SOR ‚Üí Chapter 1                      |
| 3  | 2         | 2         | Chapter 1A  | 1               | SOR ‚Üí Chapter 1->Chapter 1A          |
| 4  | 2         | 3         | Item 1      | 1               | SOR ‚Üí Chapter 1-‚Üí Item 1             |
| 5  | 3         | 3         | Item 2      | 1               | SOR ‚Üí Ch 1->Ch 1A ‚Üí Item 2           |

---

### üß† Key Notes

* The table supports **any depth of nesting** ‚Äî chapters within chapters within items.
* **Chapters do not have rates**, but **items do**.
* The combination of `id`, `parent_id`, and `sor_id` defines the **full structure** of a SOR.
* **Ordering** is maintained using `order_in_parent` and is crucial for reconstructing the tree correctly via the **nested set model** (`lft`, `rgt`, `depth`).
*   The `name` field is automatically generated and maintained by the `App\Observers\ItemObserver` whenever an `Item` model is created or updated. This observer ensures the hierarchical naming conventions are consistently applied.
